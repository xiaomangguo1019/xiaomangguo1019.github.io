
<center><font size=7 > Flomesh 用户手册 </font></center>


# 1 引言

## 1.1 编写目的 
该手册是为了方便用户使用[Flomesh](https://flomesh.cn/)系统，阐明如何使用Flomesh系统，向用户解释该系统的作用或在必要时作为参考。  

预期的读者为广大的云用户以及系统的开发测试人员。  

## 1.2 背景

开发软件的名称：Flomesh  
项目任务的提出者：全体xx项目组成员  
实现软件单位：xx项目组   
产品用户：所有的在线使用的云客户及该软件项目的任务提出者，开发者，用户（或首批用户）及安装此软件的计算中心

## 1.3 定义 

Flomesh易衡科技提供行业领先的**应用流量管理产品**与解决方案。是以技术为驱动力，开源了核心流量管理组件 [pipy](https://github.com/flomesh-io/pipy) 。是目前已知开源软件中速度最快（TPS & Latency）的代理类软件。同期，其内置的JavaScript引擎为用户扩展开发流量管理策略提供了便利的选择，是企业级流量管理的不二选择。


# 2 用途

## 2.1 功能  
  
<mermaid/>
<div class="mermaid"> 
graph LR
A[Flomesh] --> |核心|B(pipy)
B --> C[流量管理]
B --> D[信息安全]
B -->E[可观察性]
C -->|性能| F[负载均衡]
C -->|性能| G[反向代理]
C -->|性能| L[分流]
D -->|性能| H[身份认证]
D -->|性能| I[访问控制]
D -->|性能| M[数据审计]
E -->|性能| J[流量拓扑]
E -->|性能| K[实时监控]
E -->|性能| N[服务治理]
</div>  

用户可以快速构建一站式、支持多云环境、兼容不同计算环境(小机、X86物理机、虚拟机、容器、FAAS)的应用流量管理平台，实现混合云时代一体化的基于流量的管理能力，满足云原生时代计算单元更小、计算资源生命周期更短的敏捷需求。


### 导航栏    
************************

导航栏分为四个模块。 

![信息](https://wx1.sinaimg.cn/mw2000/004eEpTYly1gud38uxhc1j600d00d0fy02.jpg) **信息：** 分为 **告警**， **通知** 和 **消息** 三部分。告警会按时间逐条显示最新应用流量状况，并显示几条未读。通知可显示系统发布的多种通知。消息会显示收到的信息。
 

![](/dao2.png) **语言：** 分为中文，英文和日语三种语言。点击可切换语言模式。   

![](/dao3.png) **用户中心：** 点击这里会显示当前登录用户部分信息，点击用户中心可查看用户全部 **信息**，以及用户当前 **权限**。

![](/dao4.png) **系统：** 点击系统可进行创建。
  
  
<mermaid/>
<div class="mermaid">
graph LR
A[系统] -->| | C{选择操作}
C -->|记录项目开发人员| D[组织]
C -->|记录项目详情| E[项目]
C -->|创建角色类型| F[角色]
C -->|创建其他账户并分配权限| G[用户管理]
C -->|自定义项目或预览已有项目| H[自定义小组件]
C -->|    | I[拓扑编辑器]
</div> 


  
### Default K8s   

************************

点击下拉菜单可选择环境搭建。本系统默认  **K8s** 开发环境。

 ![](/huanjing2.png) 

### 工作台
  
点击工作台可查看已添加的组件情况。按住 ![](/1.1.png) 可调整组件顺序，点击 ![](/1.2.png) 可将组件从工作台移除。 **右键** 工作台，可进行关闭和刷新操作。
  
![](/1.3.png)  
  
点击右方 **配置** 可预览项目情况，可选择将项目添加或移除工作台，方便查看。 
  
![](/gongzuotai.png)
 
+ #### 自定义小组件怎么怎么创建并添加到工作台的？  

************************
**创建：** 点击右上角的 ![](/dao4.png) 选择 **自定义小组件** ，点击右方的 **定制组件** ，填写组件的的信息， **保存** 即可创建成功。 
 
::: tip
ID不可重复
:::  

**添加：** 在工作台界面中点击右方 **配置** ，选择 **自定义** ，点击 **开/关** 来选择添加/移除自定义的组件。

![](/1.4.png)

+ #### 在工作台添加其他模块组件？    

************************  
点击右方 **配置** ，找到要添加或移除的组件，点击 **开/关** 来选决定添加/移除自定义的组件。
::: tip
点击组件右上方的 ![](/1.2.png) 可轻松将组件从工作台移除
:::  


+ #### 在其他模块的看板首页如何添加到工作台？  

************************
点击要添加组件的右上方的 ![](/1.2.png) ，选择 **订阅到工作台** 即可添加，再次点击即可移除


<mermaid/>
<div class="mermaid">
graph TD
K[系统设置]-->I[自定义组件]
I[自定义组件]-->M[新建组件]
M-->|订阅|E[偏好组件]
D-->|订阅|E[偏好组件]
B[首页 ] --> A
A[我的工作台 ] --> D[配置组件]
A --> E[偏好 组件]
O[服务网格看板]-->N[组件]
P[计算资源看板]-->N[组件]
N-->|订阅|E[偏好组件]
</div> 

  



###  FSM|服务网格
  

************************


服务网格 FSM（Flomesh Service Mesh）是羽量级的、易拓展的、可定制的服务网格软件；提供开箱即用的服务网格能力，同时提供丰富接口满足DIY场景需求。
  
特点：**低资源**、**高性能**、**易扩展**、**简单易用**、**更安全**。  

+ ####  看板：  


可查看服务列表，边车，注册中心的基本信息以及服务，边车和进栈的健康与非健康的个数统计。并且可检查任意时间点的服务健康。点击![](/1.2.png) 添加到工作台方便查看。

![](/3.1.png)  
  
+ #### 拓扑：

选择右上角需要统计的 **时间段** ，可对服务质量，延迟情况，加载状态，吞吐量/错误率以及比特率进行概览。  

![](/tuopu.png)

+ #### 边车：
输入查询条件进行查询边车情况。点击 **创建边车** ，修改 YAML 和 JSON 以及策略的值，点击创建即可创建边车成功。  

![](/3.3.png)


反向代理（边车）可以做限流，限速，黑白名单，正向代理（边车）可以控制目标服务的地址，最终把边车抓取的请求和相应的日志都发送到Logger中，进行记录日志和 metrics 信息的统计。

<mermaid/>
<div class="mermaid">
sequenceDiagram
Inbound Sidecar（反向代理）->>Service: Http
Service->>Outbound Sidecar（正向代理）: 传递，捕获，记录tracing信息
Inbound Sidecar（反向代理）->>Logger: 抓取请求和相应日志
Outbound Sidecar（正向代理）->>Logger: 抓取请求和相应日志
</div>



+ #### 时序：
可输入连接方式或时间查询时序。点开 **ID** 可查询时序详情。点击 ![](/3.42.png) 可展开重复 ID 详情。

![](/3.41.png)

+ #### 注册中心：
输入关键字查询注册情况。  

![](/3.5.png)

点击名称可查看详细信息，点击 ![](/3.50.png) 可查看服务列表中YAML和JSON的值，点击 ![](/1.2.png) 可进行导入，同步，编辑和删除操作。
点击 ![](/3.51.png) 可进行新的注册，输入相关信息即可创建成功。 
 
![](/3.52.png)

<mermaid/>
<div class="mermaid">
graph TD
A[注册中心] -->B(有效注册)
A[注册中心] -->G(无效注册)
B --> D[含边车服务]
B --> H[无边车服务]
D --> E[使用中边车]
D --> F[闲置边车]
</div> 



+ #### 服务：
输入关键字可查询服务信息。点击 名称 可查看详情，点击 ![](/1.2.png) 可进行编辑或删除。

![](/3.6.png)

+ #### 进栈列表：
输入关键字可查询进栈情况并进行操作。点击名称或 ![](/1.2.png) 可进行编辑或删除。

![](/3.71.png)

点击 ![](/3.51.png) 并填写进栈名称，选择端点和规则（也可 ![](/3.51.png) 新的端点和规则）即可创建新的进栈，也可添加标签和注释的值，以便查找。  

![](/3.7.png)

+ #### 出栈列表：
输入关键字可查询出栈情况并进行操作。点击名称或 ![](/1.2.png) 可进行编辑或删除。点击 ![](/3.51.png) 并填写出栈名称，选择协议类型并设置端口号即可创建新的出栈。 

![](/3.8.png)

也可设置 IP 的黑白名单，点击新建，并填写 IP池即可。

![](/3.81.png)

### Workload|计算资源   


************************


+ #### 看板：

可查看定时任务，守护进程组，部署组，任务，Pods ，副本集，复制控制器以及有状态组的概况。点击 ![](/1.2.png) 可订阅到工作台。

![](/4.1.png)


+ #### 定时任务：

关键字搜索可查询定时任务。

![](/4.2.png)


+ #### 守护进程组：

关键字搜索可查询守护进程组。

![](/4.3.png)


+  #### 部署组：

部署组是一个部署目标计算机逻辑集，其中每台计算机上都安装了代理。

在这里可查看 **CPU Usage** 和 **Memory Usage** 随时间变化而变化的情况。关键字搜索可查询部署组。点击部署名称或 ![](/1.2.png) 可查询详情。

![](/4.4.png)

+  #### 任务：

关键字搜索可查询已创建的任务。

![](/4.5.png)


+  #### Pods：

可查看 **CPU Usage** 和 **Memory Usage** 随时间变化而变化的情况。关键字搜索可查询Pods。点击名称 可查询详情。点击 ![](/1.2.png) 可进行view和删除操作。

![](/4.6.png)

+  #### 副本集：

可查看 **CPU Usage** 和 **Memory Usage** 随时间变化而变化的情况。关键字搜索可查询副本集。点击名称或 ![](/1.2.png) 可查询详情。

![](/4.7.png)


+  #### 复制控制器：

关键字搜索可查询复制控器。

![](/4.8.png)


+  #### 有状态组：

关键字搜索可查询有状态组。

![](/4.91.png)

点击名称或点击 ![](/1.2.png) 选择 view 可查看有状态组详情。

![](/4.92.png)  

点击注释可查看注释信息。  
   
也可点击概览，Pods 或事件进行相关查询。
> 概览：查询镜像等资源信息，以及 Pod状态。   
> Pods：可查询相同状态的 Pods。  
> 事件：可查询相同状态的事件信息。

+  #### 秘钥：

点击名称或点击 ![](/1.2.png) 选择 view 可查看秘钥详情，以及相关资源信息。

![](/4.100.png)


### OpenCenter|运维中心   


************************


+ #### 日志：

可按条件并输入关键字或时间筛选来查找日志，查找到的日志可按选择的排序特点升序或降序排列。点击 ID 号可查看源代码。  

![](/7.1.png)

+ #### 操作记录： 
 
可输入用户或 IP 或 ID  来搜索操作记录。   

![](/7.2.png)

+ #### 组件管理：  

可分区查询组件信息。

![](/7.31.png)

点击 **创建组件** 并填写组件名称对组件进行分区以及分类即可创建新的组件。

![](/7.32.png)

+ #### 证书管理：    
点击 **创建证书** 并填写证书属性可创建新的证书。  

![](/7.4.png)

点击 ![](/7.41.png) 或 ![](/1.2.png) 可对此证书进行编辑，修改名称和私钥信息。

![](/7.42.png)

+ #### 告警配置：
可搜索关键字来查询告警配置，点击名称或![](/1.2.png) 可对此条告警进行编辑。

![](/7.51.png)

点击右上角 ![](/3.51.png) 可根据需要的规则创建新的告警。点击规则旁的 ![](/3.51.png) 可同时限制多条规则。  
    
![](/7.5.png)
